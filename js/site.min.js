/*
 * DeliveryTrack
 * Copyright 2017 Andrew Wong <featherbear@navhaxs.au.eu.org>
 *
 * The following code is licensed under the MIT License
 */
 var serviceMap={};const table={html:document.getElementById("viewTable").getElementsByTagName("tbody")[0],data:localStorage.hasOwnProperty("tableData")?JSON.parse(localStorage.tableData):{},insert(a){if(a=a.toString(),!(a in this.data)){var b=serviceUtil.identify(a);b&&(serviceMap[a]=b,a=a,this.data[a]="",this.html.appendChild(this.newRow(a)),this.save())}},remove(a){a=a.toString(),a in this.data&&(delete this.data[a],this.html.removeChild(this.getRowHTML(a)),this.save())},requestUpdate(a){ids=a?[a.toString()]:Object.keys(this.data),ids.forEach(b=>serviceUtil.check(b))},update(a){ids=a?[a.toString()]:Object.keys(this.data),ids.forEach(b=>{this.getRowHTML(b).getElementsByTagName("td")[1].innerText=this.data[b]})},save(){localStorage.tableData=JSON.stringify(this.data)},newRow(a){return(row=document.createElement("tr")).innerHTML="<td>"+a+"</td><td></td><td></td>",row.lastElementChild.onclick=()=>table.remove(a),row},getRowHTML(a){return Array.from(this.html.getElementsByTagName("tr")).find(b=>{return b.firstElementChild.innerHTML==a.toString()})}};(input=document.getElementById("trackingIdInput")).onkeypress=function(a){a||(a=window.event);var b=a.keyCode||a.which;if("13"==b)return input.value.split(" ").filter(c=>c.length).forEach(c=>table.insert(c)),input.value="",!0};var HTMLhead=document.getElementsByTagName("head")[0]||document.documentElement;function getJSON(a,b,c){var d="_"+(c?c:+ +new Date);window[d]=b,script=document.createElement("script"),script.src="http://anyorigin.com/go?url="+escape(a)+"&callback="+d,script.onload=function(){HTMLhead.removeChild(this)},HTMLhead.appendChild(script)}const serviceUtil={identify(a){return services.find(b=>{return b.regex.test(a)})},check(a){service=serviceMap[a]?serviceMap[a]:this.identify(a),service&&getJSON(service.request+a,b=>{table.data[a]=service.callback(b).toString(),table.update(a),table.save()},a)}};for(var id in table.html.innerHTML="",table.data)id.length&&(table.html.appendChild(table.newRow(id)),serviceMap[id]=serviceUtil.identify(id));